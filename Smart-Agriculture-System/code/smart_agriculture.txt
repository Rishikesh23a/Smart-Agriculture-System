#include <ESP8266WiFi.h>
#include <Firebase_ESP_Client.h>
#include <DHT.h>

// ----------------- WiFi & Firebase Credentials -----------------
#define WIFI_SSID "Airtel_Mighty Raju"
#define WIFI_PASSWORD "Mitaoe#701"

#define API_KEY  // your full key
#define DATABASE_URL // your full DATABASE_URL

// ----------------- Sensor Pins -----------------
#define DHTPIN D4
#define DHTTYPE DHT11
#define ANALOG_PIN A0

DHT dht(DHTPIN, DHTTYPE);

FirebaseData fbdo;
FirebaseAuth auth;
FirebaseConfig config;

// ----------------- Setup -----------------
void setup() {
Â  Serial.begin(115200);
Â  delay(1000);

Â  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
Â  Serial.print("Connecting to WiFi");
Â  while (WiFi.status() != WL_CONNECTED) {
Â    Serial.print(".");
Â    delay(500);
Â  }
Â  Serial.println("\nâœ… WiFi connected!");

Â  // Firebase configuration
Â  config.api_key = API_KEY;
Â  config.database_url = DATABASE_URL;

Â  // Anonymous sign-in
Â  if (Firebase.signUp(&config, &auth, "", "")) {
Â    Serial.println("âœ… Firebase sign-up successful!");
Â  } else {
Â    Serial.printf("âŒ Sign-up Error: %s\n", config.signer.signupError.message.c_str());
Â  }

Â  Firebase.begin(&config, &auth);
Â  Firebase.reconnectWiFi(true);

Â  dht.begin();
Â  Serial.println("âœ… Firebase initialized!");
}

// ----------------- Sensor Functions -----------------
float readPH() {
Â  int samples = 10;
Â  float total = 0;
Â  for (int i = 0; i < samples; i++) {
Â    total += analogRead(ANALOG_PIN);
Â    delay(10);
Â  }
Â  float avgADC = total / samples;
Â  float voltage = avgADC * (3.3 / 1023.0);
Â  float phValue = 7 + ((2.5 - voltage) / 0.18);
Â  return phValue;
}

int readMoisture() {
Â  int val = analogRead(ANALOG_PIN);
Â  return map(val, 1023, 0, 0, 100);
}

// ----------------- Main Loop -----------------
void loop() {
Â  float temperature = dht.readTemperature();
Â  float humidity = dht.readHumidity();
Â  int moisture = readMoisture();
Â  float pH = readPH();

Â  Serial.println("\nğŸ“Š Sensor Readings:");
Â  Serial.printf("Temperature: %.2f Â°C\n", temperature);
Â  Serial.printf("Humidity: %.2f %%\n", humidity);
Â  Serial.printf("Moisture: %d %%\n", moisture);
Â  Serial.printf("pH Value: %.2f\n", pH);

Â  if (Firebase.ready()) {
Â    // Create unique path using timestamp
Â    String path = "/SmartFarm/Readings/" + String(millis());

Â    Firebase.RTDB.setFloat(&fbdo, path + "/Temperature", temperature);
Â    Firebase.RTDB.setFloat(&fbdo, path + "/Humidity", humidity);
Â    Firebase.RTDB.setInt(&fbdo, path + "/Moisture", moisture);
Â    Firebase.RTDB.setFloat(&fbdo, path + "/pH", pH);

Â    Serial.println("âœ… Data uploaded to Firebase!");
Â  }

Â  delay(5000);
}

